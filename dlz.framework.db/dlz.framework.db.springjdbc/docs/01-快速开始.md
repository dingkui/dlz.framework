# DLZ-DB 帮助文档 - 快速开始

## 1.1 环境要求
### 基础环境
| 环境 | 版本要求 | 说明 |
|------|---------|------|
| JDK | 8+ | 支持 JDK 8、11、17、21 |
| Maven | 3.6+ | 或 Gradle 6+ |
| Spring Boot | 2.x / 3.x | 可选，支持非 Spring 环境 |
### 支持的数据库
| 数据库 | 版本 | 测试状态 |
|--------|------|---------|
| MySQL | 5.7+ | ✅ 完全支持 |
| PostgreSQL | 10+ | ✅ 完全支持 |
| Oracle | 11g+ | ✅ 完全支持 |
| SQL Server | 2012+ | ✅ 完全支持 |
| 达梦 | DM8 | ✅ 完全支持 |
| 人大金仓 | V8 | ✅ 完全支持 |
### 依赖说明
DLZ-DB 核心依赖：
- spring-jdbc（可选）
- jackson-databind（用于 JSON 处理）

无其他重型依赖，保持轻量。

---

## 1.2 安装配置
### maven引入
```xml
<dependency>
    <groupId>com.dlz</groupId>
    <artifactId>dlz-db-spring-boot-starter</artifactId>
    <version>${最新版本}</version>
</dependency>
```
### 配置：Spring Boot 数据源配置
```yaml
# application.yml
spring:
  datasource:
    driver-class-name: com.mysql.cj.jdbc.Driver
    url: jdbc:mysql://localhost:3306/test?useSSL=false&serverTimezone=Asia/Shanghai
    username: root
    password: 123456

# DLZ-DB 配置（可选）
dlz:
  db:
    # 是否打印 SQL 日志
    show-sql: true
    # 是否显示代码定位
    show-location: true
    # 慢 SQL 阈值（毫秒）
    slow-sql-threshold: 1000
    # 逻辑删除字段名
    logic-delete-field: is_deleted
    # 逻辑删除值
    logic-delete-value: 1
    # 逻辑未删除值
    logic-not-delete-value: 0
```

### 多数据源配置和使用

```java
final DataSourceProperty properties = new DataSourceProperty();
properties.setName("test");
properties.setDriverClassName("com.mysql.cj.jdbc.Driver");
properties.setUsername("root");
properties.setPassword("1234qwer");
properties.setUrl("jdbc:mysql://192.168.1.126:3306/test?useUnicode=true&characterEncoding=utf8&zeroDateTimeBehavior=convertToNull&transformedBitIsBoolean=true&allowMultiQueries=true&useSSL=false&allowPublicKeyRetrieval=true&serverTimezone=Asia/Shanghai");
DBDynamic.setDataSource(properties);


DBDynamic.use("test",()-> {
    DB.getById(SysSql.class, "1");
    DB.getById(SysSql.class, "2");
    return null;
});

DB.getById(SysSql.class, "1");
DBDynamic.use("default",()-> {
    DB.getById(SysSql.class, "1");
    DB.getById(SysSql.class, "2");
    return null;
});
```
```

---

## 1.3 第一个示例

```markdown
# 第一个示例

## 5 分钟快速体验

### 1. 创建数据表

```sql
CREATE TABLE `user` (
  `id` bigint NOT NULL AUTO_INCREMENT,
  `name` varchar(50) DEFAULT NULL,
  `age` int DEFAULT NULL,
  `email` varchar(100) DEFAULT NULL,
  `is_deleted` tinyint DEFAULT 0,
  `create_time` datetime DEFAULT CURRENT_TIMESTAMP,
  PRIMARY KEY (`id`)
);

INSERT INTO user (name, age, email) VALUES 
('张三', 25, 'zhangsan@example.com'),
('李四', 30, 'lisi@example.com'),
('王五', 28, 'wangwu@example.com');
```

### 2. 创建实体类（可选）

```java
@Data
@Table("user")  // 可选，默认使用类名转下划线
public class User {
    private Long id;
    private String name;
    private Integer age;
    private String email;
    private Integer isDeleted;
    private Date createTime;
}
```

### 3. 开始使用

```java
@RestController
@RequestMapping("/user")
public class UserController {

    // ========== 查询 ==========
    
    @GetMapping("/{id}")
    public User getById(@PathVariable Long id) {
        return DB.query(User.class)
            .eq(User::getId, id)
            .one();
    }
    
    @GetMapping("/list")
    public List<User> list(@RequestParam(required = false) String name) {
        return DB.query(User.class)
            .like(name != null, User::getName, name)
            .orderByDesc(User::getCreateTime)
            .list();
    }
    
    // ========== 新增 ==========
    
    @PostMapping
    public Long add(@RequestBody User user) {
        return DB.insert(user).insertWithAutoKey();
    }
    
    // ========== 修改 ==========
    
    @PutMapping
    public void update(@RequestBody User user) {
        DB.update(user)
            .eq(User::getId, user.getId())
            .execute();
    }
    
    // ========== 删除 ==========
    
    @DeleteMapping("/{id}")
    public void delete(@PathVariable Long id) {
        DB.delete(User.class)
            .eq(User::getId, id)
            .execute();
    }
}
```

### 4. 查看日志

```
[SQL]   SELECT * FROM user WHERE id = 1 AND is_deleted = 0
[耗时]  12ms
[调用]  c.e.controller.UserController.getById(UserController.java:15)
```

**恭喜！你已经完成了第一个 DLZ-DB 应用！**
```