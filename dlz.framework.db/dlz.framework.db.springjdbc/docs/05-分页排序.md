# DLZ-DB 帮助文档 - 分页排序

## 5.1 分页查询

### 创建分页参数

```java
// 基础分页
Page page = Page.build(1, 10);  // 第1页，每页10条

// 带排序的分页
Page page = Page.build(1, 10, Order.desc("create_time"));

// 多字段排序
Page page = Page.build(1, 10, Order.desc("create_time"), Order.asc("id"));
```

### Wrapper 分页

```java
// 分页查询
Page<User> result = DB.query(User.class)
    .eq(User::getStatus, 1)
    .page(Page.build(1, 10))
    .page();

// 获取数据
List<User> records = result.getRecords();  // 当前页数据
long total = result.getTotal();            // 总条数
int pages = result.getPages();             // 总页数
int current = result.getCurrent();         // 当前页
int size = result.getSize();               // 每页条数
```

### 原生 SQL 分页

```java
Page<ResultMap> result = DB.jdbcSelect(
    "SELECT * FROM user WHERE status = ?", 1
).page(Page.build(1, 10)).pageQuery();

// 生成 SQL：
// SELECT * FROM user WHERE status = 1 LIMIT 0, 10
// （同时执行 COUNT 查询获取总数）
```

### 预设 SQL 分页

```java
SqlKeyQuery query = DB.sqlSelect("user.findByCondition");
query.addPara("status", 1);
query.setPage(Page.build(1, 10, Order.desc("id")));

Page<User> result = query.pageQuery(User.class);
```

### 仅排序不分页

```java
// 只需要排序，不需要分页
List<User> users = DB.jdbcSelect("SELECT * FROM user WHERE status = ?", 1)
    .page(Page.build(Order.descs("create_time", "id")))  // 不传页码
    .queryList(User.class);

// 生成 SQL：
// SELECT * FROM user WHERE status = 1 
// ORDER BY create_time DESC, id DESC
// （无 LIMIT）
```

### 分页结果对象

```java
Page<User> page = ...;

// 常用方法
page.getRecords()    // List<User> 当前页数据
page.getTotal()      // long 总条数
page.getPages()      // int 总页数
page.getCurrent()    // int 当前页码
page.getSize()       // int 每页条数
page.hasNext()       // boolean 是否有下一页
page.hasPrevious()   // boolean 是否有上一页
```
---

## 5.2 排序

### 创建排序对象

```java
// 单字段升序
Order.asc("create_time")

// 单字段降序
Order.desc("create_time")

// 多字段升序
Order.ascs("status", "create_time")

// 多字段降序
Order.descs("create_time", "id")
```

### Wrapper 排序

```java
DB.query(User.class)
    .eq(User::getStatus, 1)
    .orderByAsc(User::getLevel)
    .orderByDesc(User::getCreateTime)
    .list();

// 生成 SQL：
// ... ORDER BY level ASC, create_time DESC
```

### 动态排序

```java
String sortField = request.getParameter("sort");      // 如 "create_time"
String sortOrder = request.getParameter("order");     // 如 "desc"

Order order = "desc".equals(sortOrder) 
    ? Order.desc(sortField) 
    : Order.asc(sortField);

DB.query(User.class)
    .page(Page.build(1, 10, order))
    .page();
```

### 安全排序（白名单）

```java
// 防止 SQL 注入，只允许特定字段排序
Set<String> allowedFields = Set.of("id", "name", "create_time", "update_time");

String sortField = request.getParameter("sort");
if (!allowedFields.contains(sortField)) {
    sortField = "create_time";  // 默认排序字段
}

Order order = Order.desc(sortField);
```

### 多字段排序

```java
// 方式1：Order 对象
Page page = Page.build(1, 10, 
    Order.desc("status"),
    Order.desc("create_time"),
    Order.asc("id")
);

// 方式2：Wrapper 链式
DB.query(User.class)
    .orderByDesc(User::getStatus)
    .orderByDesc(User::getCreateTime)
    .orderByAsc(User::getId)
    .list();

// 生成 SQL：
// ORDER BY status DESC, create_time DESC, id ASC
```

### NULL 值排序

```java
// 自定义 SQL 处理 NULL 排序
DB.query(User.class)
    .orderBySql("IFNULL(sort_num, 999999) ASC")
    .orderByDesc(User::getCreateTime)
    .list();
```
