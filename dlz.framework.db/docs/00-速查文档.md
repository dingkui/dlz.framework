# ğŸ“– # DLZ-DB å¸®åŠ©æ–‡æ¡£ - é€ŸæŸ¥æ–‡æ¡£
## ç›®å½•
[ä¸€ã€æŸ¥è¯¢æ“ä½œ](./00-é€ŸæŸ¥æ–‡æ¡£.md#ä¸€æŸ¥è¯¢æ“ä½œ)
- [1.1 åŸºäº Bean çš„æŸ¥è¯¢ï¼ˆæ¨èï¼‰](./00-é€ŸæŸ¥æ–‡æ¡£.md#11-åŸºäº-bean-çš„æŸ¥è¯¢æ¨è)
- [1.2 åŸºäºè¡¨åçš„æŸ¥è¯¢](./00-é€ŸæŸ¥æ–‡æ¡£.md#12-åŸºäºè¡¨åçš„æŸ¥è¯¢)
- [1.3 åŸç”Ÿ JDBC æŸ¥è¯¢](./00-é€ŸæŸ¥æ–‡æ¡£.md#13-åŸç”Ÿ-jdbc-æŸ¥è¯¢)
- [1.4 é¢„è®¾ SQL æŸ¥è¯¢ï¼ˆKey-SQLï¼‰](./00-é€ŸæŸ¥æ–‡æ¡£.md#14-é¢„è®¾-sql-æŸ¥è¯¢key-sql)

[äºŒã€æ¡ä»¶æ„é€ å™¨](./00-é€ŸæŸ¥æ–‡æ¡£.md#äºŒæ¡ä»¶æ„é€ å™¨)
- [2.1 åŸºç¡€æ¡ä»¶](./00-é€ŸæŸ¥æ–‡æ¡£.md#21-åŸºç¡€æ¡ä»¶)
- [2.2 èŒƒå›´æŸ¥è¯¢(IN,betweenæŸ¥è¯¢)ï¼ˆå¤šç§å†™æ³•ï¼‰](./00-é€ŸæŸ¥æ–‡æ¡£.md#22-èŒƒå›´æŸ¥è¯¢inbetweenæŸ¥è¯¢å¤šç§å†™æ³•)
- [2.3 æ¨¡ç³Šæ£€ç´¢](./00-é€ŸæŸ¥æ–‡æ¡£.md#23-æ¨¡ç³Šæ£€ç´¢)
- [2.3 OR / AND åµŒå¥—æ¡ä»¶](./00-é€ŸæŸ¥æ–‡æ¡£.md#23-or--and-åµŒå¥—æ¡ä»¶)
- [2.4 å¤æ‚åµŒå¥—ç¤ºä¾‹](./00-é€ŸæŸ¥æ–‡æ¡£.md#24-å¤æ‚åµŒå¥—ç¤ºä¾‹)
- [2.5 è‡ªå®šä¹‰ SQL ç‰‡æ®µ (Apply/Sql)](./00-é€ŸæŸ¥æ–‡æ¡£.md#25-è‡ªå®šä¹‰-sql-ç‰‡æ®µ-applysql)
- [2.6 ç©ºå€¼è‡ªåŠ¨å¿½ç•¥](./00-é€ŸæŸ¥æ–‡æ¡£.md#26-ç©ºå€¼è‡ªåŠ¨å¿½ç•¥)

[ä¸‰ã€åˆ†é¡µä¸æ’åº](./00-é€ŸæŸ¥æ–‡æ¡£.md#ä¸‰åˆ†é¡µä¸æ’åº)
- [3.1 åˆ†é¡µæŸ¥è¯¢](./00-é€ŸæŸ¥æ–‡æ¡£.md#31-åˆ†é¡µæŸ¥è¯¢)
- [3.2 æ’åº](./00-é€ŸæŸ¥æ–‡æ¡£.md#32-æ’åº)

[å››ã€æ’å…¥æ“ä½œ](./00-é€ŸæŸ¥æ–‡æ¡£.md#å››æ’å…¥æ“ä½œ)
- [4.1 Bean æ’å…¥](./00-é€ŸæŸ¥æ–‡æ¡£.md#41-bean-æ’å…¥)
- [4.2 æŒ‡å®šè¡¨åæ’å…¥](./00-é€ŸæŸ¥æ–‡æ¡£.md#42-æŒ‡å®šè¡¨åæ’å…¥)

[äº”ã€æ›´æ–°æ“ä½œ](./00-é€ŸæŸ¥æ–‡æ¡£.md#äº”æ›´æ–°æ“ä½œ)
- [5.1 Bean æ›´æ–°](./00-é€ŸæŸ¥æ–‡æ¡£.md#51-bean-æ›´æ–°)
- [5.2 æŒ‡å®šè¡¨åæ›´æ–°](./00-é€ŸæŸ¥æ–‡æ¡£.md#52-æŒ‡å®šè¡¨åæ›´æ–°)
- [5.3 å¤æ‚æ¡ä»¶æ›´æ–°](./00-é€ŸæŸ¥æ–‡æ¡£.md#53-å¤æ‚æ¡ä»¶æ›´æ–°)

[å…­ã€åˆ é™¤æ“ä½œ](./00-é€ŸæŸ¥æ–‡æ¡£.md#å…­åˆ é™¤æ“ä½œ)
- [6.1 Bean åˆ é™¤ï¼ˆè‡ªåŠ¨é€»è¾‘åˆ é™¤ï¼‰](./00-é€ŸæŸ¥æ–‡æ¡£.md#61-bean-åˆ é™¤è‡ªåŠ¨é€»è¾‘åˆ é™¤)
- [6.2 æ¡ä»¶åˆ é™¤](./00-é€ŸæŸ¥æ–‡æ¡£.md#62-æ¡ä»¶åˆ é™¤)
- [6.3 å®‰å…¨æœºåˆ¶ï¼šæ— æ¡ä»¶åˆ é™¤æ›´æ–°ä¿æŠ¤](./00-é€ŸæŸ¥æ–‡æ¡£.md#63-å®‰å…¨æœºåˆ¶æ— æ¡ä»¶åˆ é™¤æ›´æ–°ä¿æŠ¤)

[ä¸ƒã€é¢„è®¾ SQLï¼ˆKey-SQLï¼‰](./00-é€ŸæŸ¥æ–‡æ¡£.md#ä¸ƒé¢„è®¾-sqlkey-sql)
- [7.1 é…ç½®é¢„è®¾ SQL](./00-é€ŸæŸ¥æ–‡æ¡£.md#71-é…ç½®é¢„è®¾-sql)
- [7.2 ä½¿ç”¨é¢„è®¾ SQL](./00-é€ŸæŸ¥æ–‡æ¡£.md#72-ä½¿ç”¨é¢„è®¾-sql)
- [7.3 é¢„è®¾ SQL åµŒå¥—](./00-é€ŸæŸ¥æ–‡æ¡£.md#73-é¢„è®¾-sql-åµŒå¥—)

[ğŸ”§ é«˜çº§ç‰¹æ€§](./00-é€ŸæŸ¥æ–‡æ¡£.md#-é«˜çº§ç‰¹æ€§)
- [å¤šæ•°æ®æºæ”¯æŒ](./00-é€ŸæŸ¥æ–‡æ¡£.md#å¤šæ•°æ®æºæ”¯æŒ)
- [äº‹åŠ¡æ§åˆ¶](./00-é€ŸæŸ¥æ–‡æ¡£.md#äº‹åŠ¡æ§åˆ¶)
- [å¤šæ•°æ®æºäº‹åŠ¡æ§åˆ¶](./00-é€ŸæŸ¥æ–‡æ¡£.md#å¤šæ•°æ®æºäº‹åŠ¡æ§åˆ¶)
- [SQL æ³¨å…¥é˜²æŠ¤](./00-é€ŸæŸ¥æ–‡æ¡£.md#sql-æ³¨å…¥é˜²æŠ¤)


## ä¸€ã€æŸ¥è¯¢æ“ä½œ
* [å›åˆ°ç›®å½•](./00-é€ŸæŸ¥æ–‡æ¡£.md#ç›®å½•)
### 1.1 åŸºäº Bean çš„æŸ¥è¯¢ï¼ˆæ¨èï¼‰
```java
// æŸ¥è¯¢å•æ¡
User user = DB.Pojo.select(User.class)
    .eq(User::getId, 1)
    .queryOne();

// æŸ¥è¯¢åˆ—è¡¨
List<User> users = DB.Pojo.select(User.class)
    .eq(User::getStatus, 1)
    .queryList();

// æŸ¥è¯¢æ•°é‡
long count = DB.Pojo.select(User.class)
    .eq(User::getStatus, 1)
    .count();
```

### 1.2 åŸºäºè¡¨åçš„æŸ¥è¯¢
```java
// è¿”å› ResultMapï¼ˆç»§æ‰¿è‡ª JSONMapï¼Œæ”¯æŒæ·±åº¦å–å€¼ï¼‰
ResultMap result = DB.Table.query("sys_user")
    .eq("status", 1)
    .one();

// å–å€¼
String name = result.getStr("name");
Integer age = result.getInt("profile.age", 0);
```

### 1.3 åŸç”Ÿ JDBC æŸ¥è¯¢
```java
// ä½¿ç”¨ ? å ä½ç¬¦
JdbcQuery query = DB.Jdbc.select(
    "SELECT * FROM user WHERE status = ? AND age > ?", 
    1, 18
);

// è·å–ç»“æœ
List<ResultMap> list = query.queryList();
String value = query.queryStr();
```

### 1.4 é¢„è®¾ SQL æŸ¥è¯¢(key-sql)
```java
// é€šè¿‡ key è·å–é¢„è®¾çš„ SQLï¼ˆæ”¯æŒåœ¨æ•°æ®åº“ä¸­åœ¨çº¿ç¼–è¾‘ï¼‰
SqlQuery query = DB.Sql.select("user.findByCondition");
query.addPara("status", 1);
query.addPara("name", "å¼ ä¸‰");
query.setPage(Page.build(1, 10));

List<User> users = query.queryList(User.class);
```

---

## äºŒã€æ¡ä»¶æ„é€ å™¨
* [å›åˆ°ç›®å½•](./00-é€ŸæŸ¥æ–‡æ¡£.md#ç›®å½•)
### æ¡ä»¶æ–¹æ³•ä¸€è§ˆ
| æ–¹æ³•               | è¯´æ˜    | ç¤ºä¾‹                                |
|------------------|-------|-----------------------------------|
| `isn(å­—æ®µ)`        | ä¸ºç©º    | `column IS NULL`                  |
| `isnn(å­—æ®µ)`       | ä¸ä¸ºç©º   | `column IS NOT NULL`              |
| `eq(å­—æ®µ, å€¼)`      | ç­‰äº    | `column = ?`                      |
| `ne(å­—æ®µ, å€¼)`      | ä¸ç­‰äº   | `column <> ?`                     |
| `gt(å­—æ®µ, å€¼)`      | å¤§äº    | `column > ?`                      |
| `ge(å­—æ®µ, å€¼)`      | å¤§äºç­‰äº  | `column >= ?`                     |
| `lt(å­—æ®µ, å€¼)`      | å°äº    | `column < ?`                      |
| `le(å­—æ®µ, å€¼)`      | å°äºç­‰äº  | `column <= ?`                     |
| `in(å­—æ®µ, å€¼åˆ—è¡¨)`    | åœ¨åˆ—è¡¨ä¸­  | `column IN (val1, val2, ...)`     |
| `ni(å­—æ®µ, å€¼åˆ—è¡¨)`    | ä¸åœ¨åˆ—è¡¨ä¸­ | `column NOT IN (val1, val2, ...)` |
| `lk(å­—æ®µ, å€¼)`      | æ¨¡ç³ŠåŒ¹é…  | `column LIKE ?` (å€¼ä¼šè¢«åŠ ä¸Š`%`)        |
| `ll(å­—æ®µ, å€¼)`      | å·¦æ¨¡ç³ŠåŒ¹é… | `column LIKE ?` (å€¼ååŠ `%`)          |
| `lr(å­—æ®µ, å€¼)`      | å³æ¨¡ç³ŠåŒ¹é… | `column LIKE ?` (å€¼å‰åŠ `%`)          |
| `nl(å­—æ®µ, å€¼)`      | éæ¨¡ç³ŠåŒ¹é… | `column NOT LIKE ?` (å€¼å‰ååŠ `%`)     |
| `bt(å­—æ®µ, å€¼1, å€¼2)` | èŒƒå›´æŸ¥è¯¢  | `column BETWEEN ? AND ?`          |
| `nb(å­—æ®µ, å€¼1, å€¼2)` | éèŒƒå›´æŸ¥è¯¢ | `column NOT BETWEEN ? AND ?`      |

### 2.1 åŸºç¡€æ¡ä»¶
```java
DB.Pojo.select(User.class)
        // åŸºç¡€æ¯”è¾ƒæ“ä½œ
        .eq(User::getStatus, 1)           // status = 1
        .ne(User::getType, 0)             // type <> 0
        .gt(User::getAge, 18)             // age > 18
        .ge(User::getScore, 60)           // score >= 60
        .lt(User::getLevel, 10)           // level < 10
        .le(User::getRetryCount, 3)       // retry_count <= 3
        // ç©ºå€¼æ£€æŸ¥
        .isn(User::getDeleteTime)         // delete_time IS NULL
        .isnn(User::getEmail)             // email IS NOT NULL
        .queryList();
```

### 2.2 èŒƒå›´æŸ¥è¯¢(IN,betweenæŸ¥è¯¢)ï¼ˆå¤šç§å†™æ³•ï¼‰
```java
DB.Pojo.select(User.class)
    // æ–¹å¼1ï¼šé€—å·åˆ†éš”çš„å­—ç¬¦ä¸²
    .in(User::getId, "1,2,3,4,5")   // id IN (1,2,3,4,5)
    // æ–¹å¼2ï¼šé€—å·åˆ†å‰²çš„å­—ç¬¦ä¸²
    .in(User::getCode, "A,B,C")  //code IN ('A','B','C')
    // æ–¹å¼3ï¼šå­æŸ¥è¯¢
    .in(User::getId, new Integer[]{1, 2, 3, 4, 5}) // id IN (1,2,3,4,5)
    // æ–¹å¼4ï¼šå­æŸ¥è¯¢
    .in(User::getDeptId, "sql:SELECT id FROM dept WHERE status = 1") //dept_id IN (SELECT id FROM dept WHERE status = 1)
    
    // not in
    .ni(User::getName, "admin,root")  // name NOT IN ('admin','root')
        
    //between
    .bt(User::getAge, 18, 30) //AGE between 18 and 30
    .bt(User::getAge, Arrays.asList(18, 30))//AGE between 18 and 30
    .bt(User::getAge, new Integer[]{18,30})//AGE between 18 and 30
    .bt(User::getAge, "18","30")//AGE between '18' and '30'
    .bt(User::getAge, "18,30")//AGE between '18' and '30'
    .bt(User::getAge, new String[]{"18","30"})//AGE between '18' and '30' 
    .bt(User::getCreateTime, DateUtil.getDate("2020-01-01"), DateUtil.getDate("2020-01-01"))//CREATE_TIME between '2020-01-01 00:00:00' and '2021-01-01 00:00:00'

    //not between
    .nb(User::getScore, 0, 60) //SCORE not between 0 and 60
    .queryList();
```
### 2.3 æ¨¡ç³Šæ£€ç´¢
```java
DB.Pojo.select(User.class)
    .lk(User::getName, "å¼ ")          // name LIKE '%å¼ %' (æ¨¡ç³ŠåŒ¹é…)
    .ll(User::getPhone, "138")        // phone LIKE '138%' (å·¦æ¨¡ç³ŠåŒ¹é…)
    .lr(User::getAddress, "åŒ—äº¬")      // address LIKE '%åŒ—äº¬' (å³æ¨¡ç³ŠåŒ¹é…)
    .nl(User::getDescription, "æµ‹è¯•")  // description NOT LIKE '%æµ‹è¯•%' (éæ¨¡ç³ŠåŒ¹é…)
    .queryList();
```

### 2.3 OR / AND åµŒå¥—æ¡ä»¶
```java
// åœºæ™¯ï¼šæŸ¥è¯¢ (status=1) AND (name='å¼ ä¸‰' OR age>20)
DB.Pojo.select(User.class)
    .eq(User::getStatus, 1)
    .or(w -> w
        .eq(User::getName, "å¼ ä¸‰")
        .gt(User::getAge, 20)
    )
    .list();

// åœºæ™¯ï¼šæŸ¥è¯¢ (type=1 OR type=2) AND (status=1 AND level>3)
DB.Pojo.select(User.class)
    .or(w -> w
        .eq(User::getType, 1)
        .eq(User::getType, 2)
    )
    .and(w -> w
        .eq(User::getStatus, 1)
        .gt(User::getLevel, 3)
    )
    .list();
```

### 2.4 å¤æ‚åµŒå¥—ç¤ºä¾‹
```java
// åœºæ™¯ï¼šæ ¡éªŒèœå•ç¼–ç æˆ–åç§°æ˜¯å¦é‡å¤ï¼ˆæ’é™¤è‡ªå·±ï¼‰
Menu menu = new Menu();
menu.setId(100L);
menu.setCode("qsm");
menu.setName("æµ‹è¯•");

DB.Pojo.select(Menu.class)
    //æ¡ä»¶åˆ¤æ–­ï¼Œå¦‚æœidä¸ä¸ºç©ºï¼Œåˆ™æ·»åŠ æ¡ä»¶
    .ne(menu.getId() != null,Menu::getId, menu.getId())
    // ç¼–ç ç›¸åŒ OR (åç§°ç›¸åŒ AND åˆ†ç±»ä¸º1)
    .or(w -> w
        .eq(Menu::getCode, menu.getCode())
        .and(s -> s
            .eq(Menu::getName, menu.getName())
            .eq(Menu::getCategory, "1")
        )
    )
    .queryList();
// ç”Ÿæˆçš„ SQLï¼š
// SELECT * FROM sys_menu 
// WHERE ID <> 100 
//   AND (CODE = 'qsm' OR (NAME = 'æµ‹è¯•' AND CATEGORY = '1')) 
//   AND IS_DELETED = 0
```

### 2.5 è‡ªå®šä¹‰ SQL ç‰‡æ®µ (Apply/Sql)
```java
// æ–¹å¼1ï¼šapply + å ä½ç¬¦ {0}, {1}
DB.Pojo.select(User.class)
    .eq(User::getStatus, 1)
    .apply("id IN (SELECT user_id FROM order WHERE amount > {0})", 1000)
    .queryList();

// æ–¹å¼2ï¼šsql + JSONMap å‚æ•°
DB.Pojo.select(User.class)
    .eq(User::getStatus, 1)
    .sql("EXISTS (SELECT 1 FROM vip WHERE user_id = t.id AND level >= #{level})",
         new JSONMap("level", 3))
    .queryList();
```

### 2.6 ç©ºå€¼è‡ªåŠ¨å¿½ç•¥
```java
// å½“å‚æ•°ä¸ºç©ºæ—¶ï¼Œæ¡ä»¶è‡ªåŠ¨å¿½ç•¥ï¼Œä¸ä¼šæŠ¥é”™
String name = null;  // å‰ç«¯æ²¡ä¼ 

DB.delete("user")
    .apply("[name = {0}]", name)  // æ–¹æ‹¬å·è¡¨ç¤ºï¼šç©ºå€¼æ—¶å¿½ç•¥æ­¤æ¡ä»¶
    .execute();

// name ä¸ºç©ºæ—¶ç”Ÿæˆï¼šDELETE FROM user WHERE IS_DELETED = 0
// name æœ‰å€¼æ—¶ç”Ÿæˆï¼šDELETE FROM user WHERE (name = 'xxx') AND IS_DELETED = 0
```

## ä¸‰ã€åˆ†é¡µä¸æ’åº
* [å›åˆ°ç›®å½•](./00-é€ŸæŸ¥æ–‡æ¡£.md#ç›®å½•)
### 3.1 åˆ†é¡µæŸ¥è¯¢
```java
// åŸºç¡€åˆ†é¡µ
Page<User> page = DB.Pojo.select(User.class)
    .eq(User::getStatus, 1)
    .page(Page.build(1, 10))  // ç¬¬1é¡µï¼Œæ¯é¡µ10æ¡
    .page();

// è·å–æ•°æ®
List<User> records = page.getRecords();
long total = page.getTotal();
```

### 3.2 æ’åº
```java
// å•å­—æ®µæ’åº
DB.Jdbc.select("SELECT * FROM user WHERE status = ?", 1)
    .page(Page.build(1, 10, Order.desc("create_time")))
    .queryList();

// å¤šå­—æ®µæ’åº
DB.Jdbc.select("SELECT * FROM user")
    .page(Page.build(1, 10, Order.descs("create_time", "id")))
    .queryList();

// æ··åˆæ’åº
DB.Jdbc.select("SELECT * FROM user")
    .page(Page.build(Order.asc("status"), Order.desc("create_time")))
    .queryList();
```

## å››ã€æ’å…¥æ“ä½œ
* [å›åˆ°ç›®å½•](./00-é€ŸæŸ¥æ–‡æ¡£.md#ç›®å½•)
### 4.1 Bean æ’å…¥
```java
User user = new User();
user.setName("å¼ ä¸‰");
user.setAge(25);

// æ™®é€šæ’å…¥
DB.Pojo.insert(user).execute();

// æ’å…¥å¹¶è¿”å›è‡ªå¢ä¸»é”®
Long id = DB.Pojo.insert(user).insertWithAutoKey();
```

### 4.2 æŒ‡å®šè¡¨åæ’å…¥
```java
DB.Table.insert("sys_user")
    .set("name", "å¼ ä¸‰")
    .set("age", 25)
    .set("create_time", new Date())
    .execute();
```

---

## äº”ã€æ›´æ–°æ“ä½œ
* [å›åˆ°ç›®å½•](./00-é€ŸæŸ¥æ–‡æ¡£.md#ç›®å½•)
### 5.1 Bean æ›´æ–°
```java
User user = new User();
user.setId(1L);
user.setName("æå››");
user.setAge(30);

// æ ¹æ® ID æ›´æ–°éç©ºå­—æ®µ
DB.Pojo.update(user)
    .eq(User::getId, user.getId())
    .execute();

// ç”Ÿæˆçš„ SQLï¼š
// UPDATE user SET name='æå››', age=30 
// WHERE id = 1 AND IS_DELETED = 0
```

### 5.2 æŒ‡å®šè¡¨åæ›´æ–°
```java
DB.Table.update("sys_user")
    .set("name", "æå››")
    .set("update_time", new Date())
    .where(Condition.where()
        .eq("id", 1)
        .eq("status", 1)
    )
    .execute();
```

### 5.3 å¤æ‚æ¡ä»¶æ›´æ–°
```java
DB.Table.update("sys_config")
    .set("value", "new_value")
    .where(Condition.where()
        .eq("type", 1)
        .and(w -> w
            .eq("category", "A")
            .eq("status", 1)
        )
        .or(w -> w
            .eq("category", "B")
            .gt("priority", 5)
        )
    )
    .execute();
```

---

## å…­ã€åˆ é™¤æ“ä½œ
* [å›åˆ°ç›®å½•](./00-é€ŸæŸ¥æ–‡æ¡£.md#ç›®å½•)
### 6.1 Bean åˆ é™¤ï¼ˆè‡ªåŠ¨é€»è¾‘åˆ é™¤ï¼‰
```java
// å½“ Bean æœ‰ isDeleted å­—æ®µæ—¶ï¼Œè‡ªåŠ¨æ·»åŠ é€»è¾‘åˆ é™¤æ¡ä»¶
DB.Pojo.delete(User.class)
    .eq(User::getId, 1)
    .execute();

// ç”Ÿæˆçš„ SQLï¼š
// DELETE FROM user WHERE id = 1 AND IS_DELETED = 0
```

### 6.2 æ¡ä»¶åˆ é™¤
```java
DB.Table.delete("sys_log")
    .where(Condition.where()
        .lt("create_time", DateUtil.addDays(new Date(), -30))
        .eq("status", 0)
    )
    .execute();
```

### 6.3 å®‰å…¨æœºåˆ¶ï¼šæ— æ¡ä»¶åˆ é™¤æ›´æ–°ä¿æŠ¤
```java
// æœªæŒ‡å®šæ¡ä»¶æ—¶ï¼Œåˆ é™¤æ¡ä»¶è‡ªåŠ¨è®¾ç½®false,ï¼ˆé˜²æ­¢æ¡ä»¶æœ‰è¯¯å…¨è¡¨åˆ é™¤ï¼‰
DB.Pojo.delete(User.class).execute();

// ç”Ÿæˆçš„ SQLï¼š
// delete from USER where false 

// æœªæŒ‡å®šæ¡ä»¶æ—¶ï¼Œæ›´æ–°æ¡ä»¶è‡ªåŠ¨è®¾ç½®ä¸ºfalse,ï¼ˆé˜²æ­¢æ¡ä»¶æœ‰è¯¯é€ æˆå…¨è¡¨æ›´æ–°ï¼‰
DB.Pojo.update(User.class).set("status", 1).execute();

// ç”Ÿæˆçš„ SQLï¼š
// update user set status =1 where false 
```

---

## ä¸ƒã€é¢„è®¾ SQLï¼ˆKey-SQLï¼‰
* [å›åˆ°ç›®å½•](./00-é€ŸæŸ¥æ–‡æ¡£.md#ç›®å½•)

 æ”¯æŒå°† SQL é¢„è®¾åœ¨é…ç½®æ–‡ä»¶æˆ–æ•°æ®åº“ä¸­ï¼Œé€šè¿‡ key è°ƒç”¨
### 7.1 é…ç½®é¢„è®¾ SQL

sqlæ–‡ä»¶é…ç½®
```xml
<?xml version="1.0" encoding="UTF-8" ?>
<sqlList>
    <!--
        æµ‹è¯•4_6_2
    -->
    <sql sqlId="key.conditionTest4_6_2"><![CDATA[
       age > #{minAge} [AND age < #{maxAge}]
    ]]></sql>
    <!--
       æµ‹è¯•5_1_4
    -->
    <sql sqlId="key.pageAndOrderTest5_1_4"><![CDATA[
       SELECT * FROM user WHERE and status = #{status}
    ]]></sql>
    <!--
       æµ‹è¯•5_1_4
    -->
    <sql sqlId="key.test.user.findActive"><![CDATA[
       SELECT * FROM user WHERE 1=1 [and status = #{status}]
    ]]></sql>
    <sql sqlId="key.test.user.find"><![CDATA[
       SELECT * FROM user WHERE 1=1
         [and name like #{name}]
         [and age > #{minAge}]
    ]]></sql>
    <sql sqlId="key.test.user.find2"><![CDATA[
     SELECT * FROM user WHERE 1=1
            [and name like #{name}]
            [and age > #{minAge}]
            [and #{key.conditionTest4_6_2}]
    ]]></sql>
</sqlList>
```      
DBé…ç½®
```java
//æ·»åŠ sqlåˆ°æ•°æ®åº“ä¸­ã€‚sqlKeyå¿…é¡»å”¯ä¸€,ä¸ç”¨æ·»åŠ "key."å¼€å¤´
SysSql SysSql = new SysSql();
SysSql.setSqlKey("test.user.findActive");
SysSql.setSqlValue("SELECT * FROM user WHERE 1=1 [and status = #{status}]");
DB.Pojo.insert(SysSql).execute();

//ä½¿ç”¨sqlã€‚æ‰€æœ‰é¢„è®¾sqlçš„keyéƒ½æ˜¯"key."å¼€å¤´
DB.Sql.select("key.test.user.findActive").addPara("status", 1).queryList();
```

### 7.2 ä½¿ç”¨é¢„è®¾ SQL
```java
// æ–¹æ‹¬å·å†…çš„æ¡ä»¶ï¼šå‚æ•°ä¸ºç©ºæ—¶è‡ªåŠ¨å¿½ç•¥
SqlQuery query = DB.Sql.select("key.test.user.find");
query.addPara("name", "å¼ ");      // æœ‰å€¼ï¼Œæ¡ä»¶ç”Ÿæ•ˆ
query.addPara("minAge", null);    // ç©ºå€¼ï¼Œæ¡ä»¶å¿½ç•¥
query.setPage(Page.build(1, 10, Order.asc("id")));

List<User> users = query.queryList(User.class);

// ç”Ÿæˆçš„ SQLï¼š
// SELECT * FROM user WHERE status = 1 AND name LIKE 'å¼ ' 
// ORDER BY id ASC LIMIT 0,10
```

### 7.3 é¢„è®¾ SQL åµŒå¥—
```java
// æ”¯æŒåœ¨é¢„è®¾ SQL ä¸­å¼•ç”¨å…¶ä»–é¢„è®¾ SQL
// key.test.user.find2 ä¸­ #{key.conditionTest4_6_2} ä¼šè¢«æ›¿æ¢ä¸ºå¦ä¸€ä¸ªé¢„è®¾ SQL çš„å†…å®¹
//æœ€ç»ˆç»“æœä¸º
"""
SELECT * FROM user WHERE 1=1
        [and name like #{name}]
        [and age > #{minAge}]
        [age > #{minAge} [AND age < #{maxAge}]]
"""
```

---

## ğŸ”§ é«˜çº§ç‰¹æ€§
* [å›åˆ°ç›®å½•](./00-é€ŸæŸ¥æ–‡æ¡£.md#ç›®å½•)
### å¤šæ•°æ®æºæ”¯æŒ
```java
// åˆ‡æ¢æ•°æ®æº
DB.Dynamic.use("test",()-> {
    return DB.Pojo.getById(SysSql.class, "1");
});
DB.Dynamic.use("default",()-> {
    return DB.Pojo.getById(SysSql.class, "1");
});
```

### äº‹åŠ¡æ§åˆ¶
æ”¯æŒspring äº‹åŠ¡æ§åˆ¶ï¼Œå¯åœ¨serviceä¸­ä½¿ç”¨@Transactionalæ³¨è§£
```java
@Transactional
public void transfer(Long fromId, Long toId, BigDecimal amount) {
    DB.Pojo.update(Account.class)
        .setSql("balance = balance - #{amount}", Params.of("amount", amount))
        .eq(Account::getId, fromId)
        .execute();
        
    DB.Pojo.update(Account.class)
        .setSql("balance = balance + #{amount}", Params.of("amount", amount))
        .eq(Account::getId, toId)
        .execute();
}
```
### å¤šæ•°æ®æºäº‹åŠ¡æ§åˆ¶
```java
DB.Dynamic.useTransactional("default",()-> {
    return DB.Pojo.getById(SysSql.class, "1");
});
```

### SQL æ³¨å…¥é˜²æŠ¤
```java
// âœ… å®‰å…¨ï¼šä½¿ç”¨ #{} å‚æ•°åŒ–æŸ¥è¯¢
DB.Pojo.select("user")
    .sql("name = #{name}", new JSONMap("name", userInput))
    .list();

// âœ… å®‰å…¨ï¼šä½¿ç”¨ ? å ä½ç¬¦
DB.Jdbc.select("SELECT * FROM user WHERE name = ?", userInput);

// âš ï¸ æ³¨æ„ï¼š${} æ˜¯ç›´æ¥æ›¿æ¢ï¼Œéœ€ç¡®ä¿æ¥æºå®‰å…¨
```

