# ğŸ—¡ï¸ JSONMap: Java æ•°æ®å¤„ç†çš„â€œç‘å£«å†›åˆ€â€
> **æ‹’ç»å¼ºè½¬åœ°ç‹±ã€‚æ‹’ç»ç©ºæŒ‡é’ˆã€‚åƒ JavaScript ä¸€æ ·åœ¨ Java ä¸­â€œä¸æ»‘â€æ“ä½œ JSONã€‚**
ä½ æ˜¯å¦å—å¤Ÿäº† Java ä¸­å¤„ç†å¤æ‚ JSON/Map æ—¶çš„ç¬¨é‡ï¼Ÿ
JSONMap ä¸æ˜¯è¦å–ä»£ Jacksonï¼Œè€Œæ˜¯è¦æ‹¯æ•‘åœ¨ **ä¸šåŠ¡é€»è¾‘å±‚** æŒ£æ‰çš„ä½ ã€‚
---
## ğŸ’¥ 3 ç§’é’Ÿï¼Œæ„Ÿå—é™ç»´æ‰“å‡»
### âŒ æ›¾ç»çš„å™©æ¢¦ (The Old Way)
ä¸ºäº†è·å–ä¸€ä¸ªæ·±å±‚åµŒå¥—çš„å€¼ `user.profile.tags[0]`ï¼Œä½ éœ€è¦å†™å‡ºä¸€åº§â€œé‡‘å­—å¡”â€ï¼š
```java
// ğŸ˜­ è¿™ç§ä»£ç æˆ‘å†™åäº†...
Map<String, Object> data = getData();
if (data != null) {
    Map<String, Object> user = (Map<String, Object>) data.get("user");
    if (user != null) {
        Map<String, Object> profile = (Map<String, Object>) user.get("profile");
        if (profile != null) {
            List<String> tags = (List<String>) profile.get("tags");
            if (tags != null && !tags.isEmpty()) {
                String tag = tags.get(0); // ç»ˆäºæ‹¿åˆ°äº†...
            }
        }
    }
}
```
### âœ… JSONMap çš„é™ä¸´ (The New Way)
ç”¨ä¸€æŠŠåˆ©å™¨ï¼Œåˆºç©¿æ‰€æœ‰å±‚çº§ï¼š
```java
// ğŸ˜ ä¸€è¡Œä»£ç ï¼Œè‡ªåŠ¨åˆ¤ç©ºï¼Œè‡ªåŠ¨å¼ºè½¬ï¼Œæ”¯æŒæ•°ç»„ä¸‹æ ‡
String tag = new JSONMap(data).getStr("user.profile.tags[0]");
```
---
## ğŸ› ï¸ ç‹¬åˆ›ä¸‰å¤§â€œç¥å…µåˆ©å™¨â€
JSONMap å°†å¤æ‚æ“ä½œå°è£…ä¸ºä¸‰ä¸ªæ ¸å¿ƒèƒ½åŠ›ï¼Œç›´å‡» Java å¼€å‘ç—›ç‚¹ã€‚
### 1. ğŸ¯ ç©¿äº‘ç®­ï¼šæ·±å±‚è·¯å¾„ç›´è¾¾ (Deep Path Access)
**ç‹¬åˆ›äº®ç‚¹**ï¼šæ— éœ€ä»»ä½•ä¸­é—´å¯¹è±¡ï¼Œç›´æ¥é€šè¿‡**ç‚¹å·**å’Œ**ä¸‹æ ‡**ç©¿é€ä»»æ„å±‚çº§ã€‚
*   **æ™ºèƒ½åˆ¤ç©º**ï¼šè·¯å¾„ä¸­ä»»æ„ä¸€ç¯ä¸º nullï¼Œç›´æ¥è¿”å› nullï¼Œç»æ—  NPEã€‚
*   **æ”¯æŒè´Ÿç´¢å¼•**ï¼š`tags[-1]` ç›´æ¥è·å–æ•°ç»„å€’æ•°ç¬¬ä¸€ä¸ªå…ƒç´ ï¼ˆPython é£æ ¼ï¼‰ã€‚
*   **æ··åˆè§£æ**ï¼šå®Œç¾å¤„ç† `Map` ä¸­åµŒå¥— `List`ï¼Œ`List` ä¸­åµŒå¥— `Map` çš„å¤æ‚åœºæ™¯ã€‚
```java
// è·å–å€’æ•°ç¬¬äºŒä¸ªå†å²è®°å½•çš„æ—¶é—´æˆ³
Long time = map.getLong("history.logs[-2].timestamp"); 
```
### 2. ğŸ—ï¸ è¿™é‡Œçš„â€œç‹¬åˆ›â€ï¼šæ„å¿µæ„å»º (Hierarchical Construction)
**ç‹¬åˆ›äº®ç‚¹**ï¼šæƒ³æ„é€  `{"a":{"b":{"c":1}}}`ï¼Ÿåˆ«å† new ä¸‰ä¸ª HashMap äº†ï¼
*   **è‡ªåŠ¨é“ºè·¯**ï¼šåªè¦ä½ ç»™è·¯å¾„ï¼Œä¸­é—´ç¼º Map è¡¥ Mapï¼Œç¼º List è¡¥ Listã€‚
*   **æ™ºèƒ½åˆå¹¶**ï¼šè·¯å¾„å·²å­˜åœ¨ï¼Ÿè‡ªåŠ¨è¯†åˆ«æ˜¯â€œè¦†ç›–â€è¿˜æ˜¯â€œåˆå¹¶â€ã€‚
```java
// âœ¨ é­”æ³•èˆ¬çš„æ„å»ºè¿‡ç¨‹
JSONMap config = new JSONMap()
    .set("server.port", 8080)             // è‡ªåŠ¨åˆ›å»º server å¯¹è±¡
    .set("db.master.ip", "192.168.1.1")   // è‡ªåŠ¨åˆ›å»º db å’Œ master å¯¹è±¡
    .add("users[0].name", "admin");       // è‡ªåŠ¨åˆ›å»º users æ•°ç»„
```
### 3. ğŸ§¬ å˜å½¢é‡‘åˆšï¼šå…¨èƒ½ç±»å‹è½¬æ¢ (Universal Type Casting)
**ç‹¬åˆ›äº®ç‚¹**ï¼šæºæ•°æ®æ˜¯ä»€ä¹ˆç±»å‹ä¸é‡è¦ï¼Œé‡è¦çš„æ˜¯**ä½ æƒ³è¦ä»€ä¹ˆç±»å‹**ã€‚
*   **å®¹é”™æ€§æå¼º**ï¼šæ•°æ®åº“å­˜çš„æ˜¯ String "100"ï¼Œä»£ç æƒ³è¦ int 100ï¼Ÿè‡ªåŠ¨è½¬ã€‚
*   **å¯¹è±¡æ˜ å°„**ï¼šæƒ³æŠŠæŸä¸ªå­èŠ‚ç‚¹ç›´æ¥è½¬æˆ Java Beanï¼Ÿä¸€é”®æå®šã€‚
```java
// æºæ•°æ®ï¼š{"score": "99.5", "info": {...}}
BigDecimal score = map.getBigDecimal("score"); // è‡ªåŠ¨è§£æå­—ç¬¦ä¸²ä¸ºæ•°å­—
User user = map.getAs("info", User.class);     // å­èŠ‚ç‚¹ç›´æ¥è½¬å¯¹è±¡
```
---
## ğŸš€ ä¸ºä»€ä¹ˆé€‰æ‹© JSONMapï¼Ÿ
| ç‰¹æ€§ | åŸç”Ÿ Map | Jackson JsonNode | **JSONMap** |
| :--- | :---: | :---: | :---: |
| **æ·±å±‚è¯»å–** | âŒ æåº¦ç¹ç | âš ï¸ é“¾å¼ get() | âœ… **å­—ç¬¦ä¸²è·¯å¾„ç›´è¾¾** |
| **ç±»å‹è½¬æ¢** | âŒ æ‰‹åŠ¨å¼ºè½¬ | âš ï¸ éœ€è¦ .asInt() | âœ… **è‡ªåŠ¨é€‚é…** |
| **æ„å»ºç»“æ„** | âŒ ç–¯ç‹‚ put | âš ï¸ ObjectNode | âœ… **è·¯å¾„ set** |
| **ç©ºæŒ‡é’ˆå®‰å…¨** | âŒ éœ€æ‰‹åŠ¨åˆ¤æ–­ | âœ… Safe | âœ… **Safe** |
| **å­¦ä¹ æˆæœ¬** | ä½ | ä¸­ | **é›¶ (çœ‹ä¸€çœ¼å°±ä¼š)** |
---
## ğŸ“š å¿«é€Ÿå¼€å§‹
```java
// 1. åŒ…è£…ä»»æ„å¯¹è±¡
JSONMap jm = new JSONMap(userMap); 
// 2. äº«å—å¼€å‘
jm.set("meta.version", "1.0");
System.out.println("Version: " + jm.getStr("meta.version"));
```
> **JSONMap** â€”â€” è®© Java çš„ JSON å¤„ç†ä¸å†æ˜¯ä½“åŠ›æ´»ã€‚